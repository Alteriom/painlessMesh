# GitHub Copilot Instructions for painlessMesh

This is the root instruction file for the Alteriom fork of painlessMesh - a library for creating mesh networks with ESP8266 and ESP32 devices.

## Quick Overview

**Repository Type:** C++ IoT Library (ESP8266/ESP32)  
**Build System:** CMake with Ninja  
**Testing Framework:** Catch2  
**Primary Use:** Mesh networking for IoT devices with Alteriom-specific extensions

## Essential Information

### What This Repository Does
painlessMesh is a library that automatically handles mesh network routing and management for ESP devices. The Alteriom fork adds specialized packages for:
- Sensor data collection and monitoring
- Device command and control
- Health and status reporting
- Advanced metrics and topology management

### Key Directories
- `src/painlessmesh/` - Core library (modify with caution)
- `examples/alteriom/` - Alteriom-specific packages and examples
- `test/catch/` - Unit tests (Catch2 framework)
- `.github/` - CI/CD workflows and detailed Copilot instructions

### Before You Start Working

#### 1. Build the Project
```bash
# Install system dependencies (Ubuntu/Debian)
sudo apt-get install -y cmake ninja-build libboost-dev libboost-system-dev

# Clone test dependencies
cd test
rm -rf ArduinoJson TaskScheduler
git clone https://github.com/bblanchon/ArduinoJson.git
git clone https://github.com/arkhipenko/TaskScheduler
cd ..

# Configure and build
cmake -G Ninja .
ninja
```

#### 2. Run Tests
```bash
# Run a specific test
./bin/catch_alteriom_packages

# Run all tests
run-parts --regex catch_ bin/
```

#### 3. Verify Your Changes
- Always build after making code changes
- Run relevant tests to ensure nothing breaks
- Check that examples still compile
- Test on both ESP32 and ESP8266 if possible

## Detailed Instructions

For comprehensive guidance, see:
- `.github/copilot-instructions.md` - Detailed coding patterns and conventions
- `.github/copilot-quick-reference.md` - Copy-paste templates and snippets
- `.github/copilot-troubleshooting.md` - Common issues and solutions
- `.github/README-DEVELOPMENT.md` - Development workflow and architecture

## Important Conventions

### Code Style
- Use `TSTRING` instead of `String` for cross-platform compatibility
- Follow 2-space indentation
- Add header guards to all `.hpp` files
- Use `alteriom::` namespace for Alteriom-specific code

### Package Type IDs
- 200: SensorPackage (environmental data)
- 201: CommandPackage (device control)
- 202: StatusPackage (health monitoring)
- 203-399: Reserved for future Alteriom packages
- 400+: Extended packages (MetricsPackage, HealthCheckPackage, etc.)

### Memory Constraints
- ESP32: ~320KB RAM (can use doubles, longer strings)
- ESP8266: ~80KB RAM (use floats, keep strings minimal)
- Always validate `mesh.sendBroadcast()` return values

## When Making Changes

1. **Adding a new Alteriom package?** 
   - Place in `examples/alteriom/alteriom_sensor_package.hpp`
   - Follow existing package templates
   - Add corresponding tests in `test/catch/catch_alteriom_packages.cpp`

2. **Modifying core library?**
   - Consult with maintainers first
   - Core files in `src/painlessmesh/` affect all users
   - Ensure backward compatibility

3. **Adding an example?**
   - Place Arduino sketches in `examples/alteriom/`
   - Include clear documentation and comments
   - Test on actual hardware when possible

## Common Tasks

### Create a New Package
See `.github/copilot-quick-reference.md` for ready-to-use templates

### Debug Build Issues
See `.github/copilot-troubleshooting.md` for solutions

### Understand the Architecture
See `.github/README-DEVELOPMENT.md` for detailed explanations

## Security & Quality

- Never commit secrets or credentials
- Run tests before submitting pull requests
- Follow semver versioning conventions
- Document all public APIs
- Consider memory implications of all changes

## Getting Help

- Check troubleshooting guide for common issues
- Review existing packages for implementation patterns  
- Consult documentation at https://alteriom.github.io/painlessMesh/
- Ask maintainers for guidance on core changes
